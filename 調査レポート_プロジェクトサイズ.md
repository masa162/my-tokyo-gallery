# プロジェクトサイズ調査レポート

## 📊 現状分析

### サイズ内訳
- **プロジェクト全体**: 約300MB
- **`.git` ディレクトリ**: 193MB（全体の約64%）
  - パックファイル: 179MB
  - その他: 14MB
- **実際のワークスペース**: 約3MB

### 問題の原因
Git履歴に**136個の画像ファイル**（各約2MB）が含まれています。
- `content/gallery/20250611gotanda_shibuya_01/` 配下の画像
- `content/gallery/20250611gotanda_shibuya_02/` 配下の画像
- その他の過去のギャラリーディレクトリの画像

### 現在の状況
✅ **良い点**: 現在のコンテンツファイル（`0611.md`など）は既にCloudinaryのURLを使用しており、外部CDNから画像を読み込んでいます。これはJamstack SSGのベストプラクティスに沿っています。

❌ **問題点**: Git履歴に過去の画像ファイルが残っており、リポジトリサイズを膨らませています。

## 🎯 推奨事項

### 1. `.gitignore`の更新（即座に実施）
画像ファイルをGitから除外する設定を追加します。

```gitignore
# 画像ファイル（Git履歴に含めない）
*.jpg
*.jpeg
*.png
*.gif
*.webp
*.JPG
*.JPEG
*.PNG
*.GIF
*.WEBP

# content/gallery配下の画像ディレクトリ
content/gallery/*/
!content/gallery/*.md
!content/gallery/*.ini
```

### 2. Git履歴のクリーンアップ（オプション）
過去の画像ファイルを履歴から削除することで、リポジトリサイズを大幅に削減できます。

**方法A: git filter-repo（推奨）**
```bash
# git filter-repoのインストール（未インストールの場合）
brew install git-filter-repo

# 画像ファイルを履歴から削除
git filter-repo --path-glob '*.jpg' --path-glob '*.jpeg' --path-glob '*.png' --path-glob '*.gif' --path-glob '*.webp' --invert-paths

# リモートに強制プッシュ（注意：履歴を書き換えます）
git push origin --force --all
```

**方法B: BFG Repo-Cleaner**
```bash
# BFGのインストール
brew install bfg

# 画像ファイルを削除
bfg --delete-files '*.{jpg,jpeg,png,gif,webp}'

# クリーンアップ
git reflog expire --expire=now --all
git gc --prune=now --aggressive
```

⚠️ **注意**: 履歴の書き換えは、他の開発者と共有しているリポジトリでは慎重に行ってください。

### 3. 今後のベストプラクティス

#### ✅ 推奨されるアプローチ
1. **画像は外部CDNに配置**
   - Cloudinary（現在使用中）✅
   - AWS S3 + CloudFront
   - Imgix
   - その他の画像CDNサービス

2. **MarkdownファイルにはURLのみ記述**
   ```yaml
   images:
     - https://res.cloudinary.com/doillqjai/image/upload/tpl/250611/001.webp
   ```

3. **ローカルの画像ファイルは`.gitignore`で除外**

#### ❌ 避けるべきアプローチ
- 画像ファイルをGitリポジトリに直接コミット
- `content/gallery/`配下に画像ディレクトリを作成してコミット

### 4. プロジェクト構造の理想形

```
my-tokyo-gallery/
├── .gitignore          # 画像ファイルを除外
├── hugo.toml
├── content/
│   └── gallery/
│       ├── 20025/
│       │   └── 0611.md  # Cloudinary URLのみ記述
│       └── ...
├── layouts/
├── static/             # 小さなアイコンやファビコンなど
└── themes/
```

**サイズ目標**: 10MB以下（テーマとコンテンツのみ）

## 📝 実施手順

### ステップ1: `.gitignore`の更新
画像ファイルを除外する設定を追加します。

### ステップ2: 現在のワークスペースの確認
既に画像ファイルが削除されていることを確認します。

### ステップ3: Git履歴のクリーンアップ（任意）
リポジトリサイズを削減したい場合は、履歴から画像を削除します。

### ステップ4: 今後の運用
新しい画像は常に外部CDNにアップロードし、MarkdownファイルにはURLのみを記述します。

## 🔍 確認コマンド

```bash
# プロジェクトサイズの確認
du -sh .

# Git履歴のサイズ確認
du -sh .git

# 大きなファイルの検索
find . -type f -size +1M | grep -v ".git"

# Git履歴内の画像ファイル数
git log --all --pretty=format: --name-only --diff-filter=A | grep -E '\.(jpg|jpeg|png|gif|webp)$' | wc -l
```

